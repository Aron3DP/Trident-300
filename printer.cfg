# THIS CONFIG IS FOR USE WITH Leviathan, Beacon & EBB36

# Required Configs, Always include these
[include mainsail.cfg]
[include macros/*.cfg]
[include timelapse.cfg]
[include K-ShakeTune/*.cfg]

#####################################################################
#   MCU / Leviathan / EBB36
#####################################################################

[mcu]
canbus_uuid: 96476c0cc178

[mcu EBB36]
canbus_uuid: d03347641955

[temperature_sensor Leviathan]
sensor_type: temperature_mcu
sensor_mcu: mcu
min_temp: 0
max_temp: 100

[temperature_sensor EBB36]
sensor_type: temperature_mcu
sensor_mcu: EBB36
min_temp: 0
max_temp: 100

[temperature_sensor RPi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100


#####################################################################
#   Machine
#####################################################################

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 10000
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 5.0

[idle_timeout]
timeout: 1800


#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to HV STEPPER 0
[stepper_x]
step_pin: PB10
dir_pin: !PB11
enable_pin: !PG0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_x]
cs_pin: PE15
spi_bus: spi4
diag0_pin: ^!PG1
driver_SGT: 0
interpolate: False
run_current: 1.0
sense_resistor: 0.075
stealthchop_threshold: 0

##  A Stepper - Right
##  Connected to HV STEPPER 1
[stepper_y]
step_pin: PF15
dir_pin: !PF14
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_y:virtual_endstop
position_min: 0
position_endstop: 307
position_max: 307
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_y]
cs_pin: PE11
spi_bus: spi4
diag0_pin: ^!PE10
driver_SGT: 0
interpolate: False
run_current: 1.0
sense_resistor: 0.075
stealthchop_threshold: 0


#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to STEPPER 0
[stepper_z]
step_pin: PD4
dir_pin: PD3
enable_pin: !PD7
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: probe:z_virtual_endstop
position_max: 290
position_min: -2.5
homing_speed: 10
second_homing_speed: 3
homing_retract_dist: 0


[tmc2209 stepper_z]
uart_pin: PD5
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Center
##  Connected to STEPPER 1
[stepper_z1]
step_pin: PC12
dir_pin: PC11
enable_pin: !PD2
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z1]
uart_pin: PD0
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Front Right
##  Connected to STEPPER 2
[stepper_z2]
step_pin: PC9
dir_pin: PC8
enable_pin: !PC10
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z2]
uart_pin: PA8
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Extruder
#####################################################################

[extruder]
step_pin: EBB36:PD0
dir_pin: !EBB36:PD1
enable_pin: !EBB36:PD2
rotation_distance: 22.50
gear_ratio: 50:8
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBB36:PB13
sensor_type: PT1000
pullup_resistor: 2200
sensor_pin: EBB36:PA3
min_temp: 10
max_temp: 350
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 500
max_extrude_cross_section: 5.0
pressure_advance: 0.02
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: EBB36:PA15
interpolate: false
run_current: 0.60
sense_resistor: 0.110
stealthchop_threshold: 0

[firmware_retraction]
retract_length: 0.5
retract_speed: 35
unretract_extra_length: 0.0
unretract_speed: 35


#####################################################################
#   ADXL / Input Shaper
#####################################################################

[resonance_tester]
accel_chip: beacon
accel_per_hz: 75
probe_points: 150, 150, 20

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 78.2
shaper_type_y = zv
shaper_freq_y = 53.4


#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PG11
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA1
pullup_resistor: 2200
max_power: 1
pwm_cycle_time: 0.0166
min_temp: 0
max_temp: 130


#####################################################################
#   Beacon
#####################################################################

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_2A25C8345154364134202020FF143F31-if00
x_offset: 0
y_offset: 22
mesh_main_direction: x
mesh_runs: 2


#####################################################################
#   Bed Mesh
#####################################################################

[bed_mesh]
speed: 450
mesh_min: 30,30
mesh_max: 270,270
probe_count: 25,25
algorithm: bicubic


#####################################################################
#   Z-Tilt
#####################################################################

[z_tilt]
z_positions:
   -50, 18
   150, 348
   350, 18
points:
   30, 12.5
   150, 252.5
   270, 12.5
speed: 450
retries: 10
retry_tolerance: 0.004
horizontal_move_z: 10


#####################################################################
#   Fan Control
#####################################################################

[fan]
pin: EBB36:PA0
kick_start_time: 0.5
off_below: 0.10

[heater_fan hotend_fan]
pin: EBB36:PA1
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

[controller_fan Controller_Fan]
pin: PF9
kick_start_time: 0.5
fan_speed: 0.50
idle_timeout: 1800


#####################################################################
# 	Chamber Thermistor
#####################################################################

[temperature_sensor Chamber]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA2
pullup_resistor: 2200
min_temp: 0
max_temp: 100
gcode_id: chamber_th


#####################################################################
# EXP1 / EXP2 (display) pins
#####################################################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PG9, EXP1_2=PG12,
    EXP1_3=PG13, EXP1_4=PG14,
    EXP1_5=PC13, EXP1_6=PC14,    # Slot in the socket on this side
    EXP1_7=PC15, EXP1_8=PF0,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PE2, EXP2_4=PE4,
    EXP2_5=PE3, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PE5, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PE4

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.518
#*# pid_ki = 1.267
#*# pid_kd = 83.098
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 65.636
#*# pid_ki = 4.376
#*# pid_kd = 246.136
#*#
#*# [beacon model default]
#*# model_coef = 1.4224131212906368,
#*# 	  1.760719564188449,
#*# 	  0.7911225972478116,
#*# 	  0.36898690428732855,
#*# 	  0.4102733854437782,
#*# 	  0.5147817459642499,
#*# 	  -0.2234086581135876,
#*# 	  -0.5490160428371165,
#*# 	  0.19906423572651866,
#*# 	  0.30632251599727406
#*# model_domain = 1.7921810629123274e-07,1.928696912017407e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 26.977205
#*# model_offset = 0.12200
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.019575, 0.035010, 0.054220, 0.057119, 0.059859, 0.064317, 0.067376, 0.080932, 0.081191, 0.089002, 0.077610, 0.070364, 0.077568, 0.081564, 0.081895, 0.097696, 0.100507, 0.098743, 0.083719, 0.076625, 0.077563, 0.064742, 0.058454, 0.048339, 0.027986
#*# 	  0.019073, 0.035287, 0.044360, 0.046209, 0.047456, 0.057776, 0.055549, 0.061661, 0.068045, 0.074413, 0.062399, 0.057877, 0.063598, 0.067339, 0.078777, 0.083001, 0.084534, 0.080604, 0.067654, 0.063622, 0.057111, 0.055108, 0.051367, 0.040622, 0.015945
#*# 	  0.010293, 0.028249, 0.038037, 0.031570, 0.032044, 0.034477, 0.040417, 0.048214, 0.054852, 0.053821, 0.049528, 0.043227, 0.050253, 0.053998, 0.064254, 0.073060, 0.065282, 0.062314, 0.052790, 0.048186, 0.043343, 0.038169, 0.028246, 0.021807, -0.002601
#*# 	  -0.004776, 0.008591, 0.017805, 0.007681, 0.011649, 0.014873, 0.019763, 0.030317, 0.041060, 0.045119, 0.039121, 0.020619, 0.027703, 0.032373, 0.043254, 0.042378, 0.037879, 0.041812, 0.032457, 0.029496, 0.021589, 0.012886, 0.002556, -0.002816, -0.028207
#*# 	  -0.017773, -0.002104, 0.007167, 0.001519, -0.000256, 0.003114, 0.008353, 0.020295, 0.031347, 0.035122, 0.016157, -0.001270, 0.000557, 0.007820, 0.025129, 0.028695, 0.028011, 0.026659, 0.017865, 0.015266, 0.007908, -0.000285, -0.012892, -0.025110, -0.044929
#*# 	  -0.023984, -0.015207, 0.007701, -0.004398, -0.008105, -0.006244, -0.000541, 0.010354, 0.015843, 0.022723, -0.000628, -0.021282, -0.022694, -0.015975, 0.005703, 0.021583, 0.013483, 0.011128, 0.002185, 0.000552, -0.006769, -0.021205, -0.026867, -0.041174, -0.052739
#*# 	  -0.029680, -0.019788, -0.003045, -0.006087, -0.010563, -0.009089, -0.006242, 0.002820, 0.014208, 0.014923, -0.007020, -0.026400, -0.027678, -0.022055, -0.003124, 0.002173, 0.003325, 0.000282, -0.007958, -0.009218, -0.014637, -0.020453, -0.034276, -0.048104, -0.066216
#*# 	  -0.029935, -0.023574, -0.004911, -0.005978, -0.009195, -0.008361, -0.007308, -0.001135, 0.006129, 0.011782, -0.004857, -0.018666, -0.018172, -0.016121, -0.003597, 0.001065, -0.003703, -0.007616, -0.016142, -0.016421, -0.021006, -0.028511, -0.039065, -0.053273, -0.069829
#*# 	  -0.034769, -0.024791, -0.010940, -0.004350, -0.007213, -0.004695, -0.004367, 0.000100, 0.007126, 0.013614, 0.000782, -0.008962, -0.006325, -0.006437, -0.000251, -0.001212, -0.003402, -0.010857, -0.018933, -0.019109, -0.024303, -0.031456, -0.044306, -0.057558, -0.069320
#*# 	  -0.035186, -0.027436, -0.014923, -0.005830, -0.005629, -0.005396, -0.005731, -0.001420, 0.006130, 0.020063, 0.006914, -0.002688, -0.002038, -0.003340, 0.000327, -0.006367, -0.008129, -0.013681, -0.022322, -0.021939, -0.027805, -0.036409, -0.043172, -0.058941, -0.065920
#*# 	  -0.036280, -0.027123, -0.011309, -0.006685, -0.008221, -0.008376, -0.008464, -0.004078, 0.004454, 0.014018, 0.006638, -0.001757, 0.000038, -0.004029, -0.000116, -0.002745, -0.009435, -0.017478, -0.026442, -0.027720, -0.032705, -0.040885, -0.052923, -0.059645, -0.059249
#*# 	  -0.031444, -0.023708, -0.009146, -0.003647, -0.006589, -0.007113, -0.007312, -0.006537, 0.003715, 0.014087, 0.007864, 0.000142, 0.002453, -0.000809, 0.004872, -0.000246, -0.008302, -0.018392, -0.028012, -0.028582, -0.037055, -0.042218, -0.054062, -0.060176, -0.058615
#*# 	  -0.019921, -0.012644, 0.000518, 0.001854, 0.001486, 0.001922, 0.001699, 0.004528, 0.011205, 0.022753, 0.012684, 0.005694, 0.007982, 0.004641, 0.005568, 0.000376, -0.006212, -0.015019, -0.025581, -0.026826, -0.032063, -0.042614, -0.052407, -0.060720, -0.056238
#*# 	  -0.010381, -0.005694, 0.007897, 0.010609, 0.008919, 0.008837, 0.009369, 0.012442, 0.016640, 0.024681, 0.017590, 0.010477, 0.013314, 0.009187, 0.009189, 0.004829, -0.002111, -0.012568, -0.021555, -0.024701, -0.031589, -0.041904, -0.053848, -0.055299, -0.065606
#*# 	  -0.010357, -0.006484, 0.005296, 0.007612, 0.006360, 0.005709, 0.005776, 0.009145, 0.013030, 0.019313, 0.012531, 0.003163, 0.006113, 0.003390, 0.003164, -0.003381, -0.011262, -0.019781, -0.028937, -0.032192, -0.041174, -0.052649, -0.064924, -0.069371, -0.080119
#*# 	  -0.012433, -0.010170, 0.000916, 0.003140, 0.000414, -0.000878, -0.001021, 0.001677, 0.005989, 0.013508, 0.003935, -0.005403, -0.002356, -0.007396, -0.008120, -0.011748, -0.019902, -0.027770, -0.038864, -0.042162, -0.049769, -0.060870, -0.077907, -0.087007, -0.098938
#*# 	  -0.017221, -0.014936, -0.002153, -0.001297, -0.004331, -0.003743, -0.006752, -0.004353, 0.000772, 0.006152, -0.003925, -0.013639, -0.011941, -0.016160, -0.015901, -0.019857, -0.027397, -0.035078, -0.046211, -0.049888, -0.056723, -0.070098, -0.085672, -0.098637, -0.114985
#*# 	  -0.019381, -0.018766, -0.007280, -0.003455, -0.005228, -0.005096, -0.008066, -0.005511, -0.001946, 0.002988, -0.007375, -0.016809, -0.017593, -0.022020, -0.020081, -0.022643, -0.030127, -0.038772, -0.050943, -0.054480, -0.060782, -0.073939, -0.088136, -0.103723, -0.121060
#*# 	  -0.017131, -0.016664, -0.006186, -0.001984, -0.003472, -0.002195, -0.003601, -0.003046, -0.000532, 0.003435, -0.006566, -0.016493, -0.016667, -0.022479, -0.022926, -0.025195, -0.031336, -0.040968, -0.051699, -0.055398, -0.063360, -0.077036, -0.092429, -0.106635, -0.124150
#*# 	  -0.014515, -0.014155, -0.004345, 0.000558, 0.000464, 0.000317, -0.001840, -0.002074, -0.000453, 0.003103, -0.006045, -0.016800, -0.017394, -0.023596, -0.023582, -0.025807, -0.034270, -0.045210, -0.058156, -0.060711, -0.067862, -0.083998, -0.096887, -0.111209, -0.125606
#*# 	  -0.014606, -0.012477, -0.003299, 0.000876, -0.000780, -0.001966, -0.004250, -0.005306, -0.004660, -0.000485, -0.011614, -0.022819, -0.022337, -0.029268, -0.028747, -0.033220, -0.041112, -0.049261, -0.064175, -0.068457, -0.077157, -0.092090, -0.107942, -0.121022, -0.132926
#*# 	  -0.011071, -0.009912, -0.000540, 0.002431, -0.000717, -0.001257, -0.006058, -0.007123, -0.006309, -0.004038, -0.016227, -0.026034, -0.026448, -0.031075, -0.032168, -0.036490, -0.044311, -0.053277, -0.067583, -0.073540, -0.081738, -0.099283, -0.113017, -0.128576, -0.144067
#*# 	  0.000366, 0.000948, 0.011749, 0.014977, 0.009711, 0.005913, 0.000596, -0.002595, -0.002944, -0.001601, -0.011768, -0.020558, -0.020109, -0.027730, -0.027896, -0.031422, -0.039347, -0.050140, -0.066663, -0.071587, -0.081621, -0.097515, -0.112554, -0.129084, -0.146951
#*# 	  0.014163, 0.016648, 0.026826, 0.029371, 0.024417, 0.017900, 0.011255, 0.007751, 0.006231, 0.009428, -0.001626, -0.012407, -0.010492, -0.018154, -0.022283, -0.026645, -0.034970, -0.046231, -0.061179, -0.068626, -0.076880, -0.094092, -0.110020, -0.125058, -0.142907
#*# 	  0.034052, 0.036840, 0.048047, 0.049453, 0.042432, 0.038202, 0.031661, 0.026290, 0.026385, 0.027566, 0.016649, 0.005831, 0.007102, -0.001872, -0.009086, -0.017020, -0.025598, -0.035391, -0.051316, -0.057566, -0.066998, -0.081802, -0.100700, -0.118279, -0.135096
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 270.0
