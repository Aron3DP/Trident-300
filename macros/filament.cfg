[gcode_macro LOAD_FILAMENT]
description: Filament loading
gcode:
    {% if printer.idle_timeout.state == "Printing" and not printer.pause_resume.is_paused %}
    RESPOND TYPE=error MSG="This macro cannot be used while printing!"
    {% else %}
    SAVE_GCODE_STATE NAME=load_state
    {% if printer.extruder.temperature < 260 %}
    RESPOND MSG="Heating..."
    M109 S260
    {% endif %}
    RESPOND MSG="Loading filament..."
    M83
    G0 E15 F2400
    G0 E60 F900
    G0 E40 F300
    M82
    M400
    RESPOND MSG="Filament loaded..."
    RESTORE_GCODE_STATE NAME=load_state
    {% endif %}


[gcode_macro UNLOAD_FILAMENT]
description: Filament unloading
gcode:
    {% if printer.idle_timeout.state == "Printing" and not printer.pause_resume.is_paused %}
    RESPOND TYPE=error MSG="This macro cannot be used while printing!"
    {% else %}
    SAVE_GCODE_STATE NAME=unload_state
    {% if printer.extruder.temperature < 260 %}
    RESPOND MSG="Heating..."
    M109 S260
    {% endif %}
    RESPOND MSG="Unloading filament..."
    M83
    G1 E10 F300
    G1 E-90 F1800
    M82
    M400
    RESPOND MSG="Filament unloaded..."
    RESTORE_GCODE_STATE NAME=unload_state
    {% endif %}